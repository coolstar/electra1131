//
//  detectConflictJailbreak.c
//  electra1131
//
//  Created by Pwn20wnd on 6/29/18.
//  Copyright Â© 2018 Electra Team. All rights reserved.
//

#include "detectConflictJailbreak.h"
#include <Foundation/Foundation.h>
#include "file_utils.h"

bool detectConflictJailbreak(void) {
    NSMutableArray *bootstrap_file_list = [[NSMutableArray alloc] initWithObjects:
                                         @"/.installed_xiaolian",
                                         @"/xiaolian",
                                         @"/var/run/io.xiaolian.helper",
                                         @"/Library/LaunchDaemons/xiaolian.plist",
                                         @"/usr/bin/lzmainfo",
                                         @"/usr/bin/iomfsetgamma",
                                         @"/usr/bin/gpgv",
                                         @"/usr/bin/tabs",
                                         @"/usr/bin/toe",
                                         @"/usr/bin/cmp",
                                         @"/usr/bin/dpkg-genbuildinfo",
                                         @"/usr/bin/locate",
                                         @"/usr/bin/db_log_verify",
                                         @"/usr/bin/cfversion",
                                         @"/usr/bin/db_upgrade",
                                         @"/usr/bin/dpkg-gencontrol",
                                         @"/usr/bin/gpg-zip",
                                         @"/usr/bin/c_rehash",
                                         @"/usr/bin/xzdec",
                                         @"/usr/bin/db_hotbackup",
                                         @"/usr/bin/infotocap",
                                         @"/usr/bin/dpkg-statoverride",
                                         @"/usr/bin/dpkg-mergechangelogs",
                                         @"/usr/bin/dpkg-deb",
                                         @"/usr/bin/diff3",
                                         @"/usr/bin/sw_vers",
                                         @"/usr/bin/db_replicate",
                                         @"/usr/bin/dpkg-divert",
                                         @"/usr/bin/gpg",
                                         @"/usr/bin/ssh-keyscan",
                                         @"/usr/bin/df",
                                         @"/usr/bin/renice",
                                         @"/usr/bin/captoinfo",
                                         @"/usr/bin/sort",
                                         @"/usr/bin/db_printlog",
                                         @"/usr/bin/unxz",
                                         @"/usr/bin/update-alternatives",
                                         @"/usr/bin/db_archive",
                                         @"/usr/bin/dpkg-name",
                                         @"/usr/bin/bashbug",
                                         @"/usr/bin/xzegrep",
                                         @"/usr/bin/dpkg-split",
                                         @"/usr/bin/dpkg-gensymbols",
                                         @"/usr/bin/tset",
                                         @"/usr/bin/unlzma",
                                         @"/usr/bin/db_stat",
                                         @"/usr/bin/db_sql_codegen",
                                         @"/usr/bin/uicache",
                                         @"/usr/bin/reset",
                                         @"/usr/bin/xzfgrep",
                                         @"/usr/bin/dpkg-distaddfile",
                                         @"/usr/bin/db_load",
                                         @"/usr/bin/pagesize",
                                         @"/usr/bin/gpgsplit",
                                         @"/usr/bin/sftp",
                                         @"/usr/bin/diff",
                                         @"/usr/bin/dpkg-source",
                                         @"/usr/bin/dpkg-buildflags",
                                         @"/usr/bin/xz",
                                         @"/usr/bin/uiopen",
                                         @"/usr/bin/dpkg-trigger",
                                         @"/usr/bin/updatedb",
                                         @"/usr/bin/dpkg-maintscript-helper",
                                         @"/usr/bin/script",
                                         @"/usr/bin/ldrestart",
                                         @"/usr/bin/time",
                                         @"/usr/bin/ssh-agent",
                                         @"/usr/bin/dpkg-scanpackages",
                                         @"/usr/bin/dpkg-checkbuilddeps",
                                         @"/usr/bin/sbdidlaunch",
                                         @"/usr/bin/dbsql",
                                         @"/usr/bin/clear",
                                         @"/usr/bin/ncursesw6-config",
                                         @"/usr/bin/tic",
                                         @"/usr/bin/db_verify",
                                         @"/usr/bin/getconf",
                                         @"/usr/bin/killall",
                                         @"/usr/bin/ssh",
                                         @"/usr/bin/lzless",
                                         @"/usr/bin/dpkg-parsechangelog",
                                         @"/usr/bin/dpkg-query",
                                         @"/usr/bin/infocmp",
                                         @"/usr/bin/ssh-add",
                                         @"/usr/bin/db_tuner",
                                         @"/usr/bin/xzless",
                                         @"/usr/bin/lzcmp",
                                         @"/usr/bin/arch",
                                         @"/usr/bin/ssh-keygen",
                                         @"/usr/bin/xzcat",
                                         @"/usr/bin/xargs",
                                         @"/usr/bin/dpkg-buildpackage",
                                         @"/usr/bin/dpkg-genchanges",
                                         @"/usr/bin/dpkg-scansources",
                                         @"/usr/bin/dpkg-shlibdeps",
                                         @"/usr/bin/xzcmp",
                                         @"/usr/bin/getty",
                                         @"/usr/bin/lzcat",
                                         @"/usr/bin/db_checkpoint",
                                         @"/usr/bin/uiduid",
                                         @"/usr/bin/dirname",
                                         @"/usr/bin/lzdiff",
                                         @"/usr/bin/find",
                                         @"/usr/bin/dpkg-architecture",
                                         @"/usr/bin/scp",
                                         @"/usr/bin/ncurses6-config",
                                         @"/usr/bin/dpkg-vendor",
                                         @"/usr/bin/lzmadec",
                                         @"/usr/bin/lzgrep",
                                         @"/usr/bin/sdiff",
                                         @"/usr/bin/db_deadlock",
                                         @"/usr/bin/lzmore",
                                         @"/usr/bin/tput",
                                         @"/usr/bin/openssl",
                                         @"/usr/bin/lzfgrep",
                                         @"/usr/bin/hostinfo",
                                         @"/usr/bin/xzmore",
                                         @"/usr/bin/tar",
                                         @"/usr/bin/xzgrep",
                                         @"/usr/bin/lzma",
                                         @"/usr/bin/db_recover",
                                         @"/usr/bin/sbreload",
                                         @"/usr/bin/login",
                                         @"/usr/bin/db_dump",
                                         @"/usr/bin/which",
                                         @"/usr/bin/gssc",
                                         @"/usr/bin/apt-key",
                                         @"/usr/bin/lzegrep",
                                         @"/usr/bin/passwd",
                                         @"/usr/bin/xzdiff",
                                         @"/usr/bin/dpkg",
                                         @"/usr/libexec/cydia/",
                                         @"/usr/libexec/frcode",
                                         @"/usr/libexec/bigram",
                                         @"/usr/libexec/code",
                                         @"/usr/libexec/ssh-pkcs11-helper",
                                         @"/usr/libexec/ssh-keysign",
                                         @"/usr/libexec/apt/",
                                         @"/usr/libexec/sftp-server",
                                         @"/usr/libexec/gnupg/",
                                         @"/usr/libexec/rmt",
                                         @"/usr/libexec/dpkg/",
                                         @"/usr/include/lzma.h",
                                         @"/usr/include/termcap.h",
                                         @"/usr/include/form.h",
                                         @"/usr/include/db.h",
                                         @"/usr/include/nc_tparm.h",
                                         @"/usr/include/unctrl.h",
                                         @"/usr/include/dbsql.h",
                                         @"/usr/include/term.h",
                                         @"/usr/include/panel.h",
                                         @"/usr/include/ncurses.h",
                                         @"/usr/include/tic.h",
                                         @"/usr/include/eti.h",
                                         @"/usr/include/ncurses_dll.h",
                                         @"/usr/include/term_entry.h",
                                         @"/usr/include/menu.h",
                                         @"/usr/include/db_cxx.h",
                                         @"/usr/include/openssl/",
                                         @"/usr/include/lzma/",
                                         @"/usr/include/ncursesw/",
                                         @"/usr/include/dpkg/",
                                         @"/usr/include/curses.h",
                                         @"/usr/sbin/accton",
                                         @"/usr/sbin/vifs",
                                         @"/usr/sbin/ac",
                                         @"/usr/sbin/reboot",
                                         @"/usr/sbin/pwd_mkdb",
                                         @"/usr/sbin/sysctl",
                                         @"/usr/sbin/sshd",
                                         @"/usr/sbin/zdump",
                                         @"/usr/sbin/halt",
                                         @"/usr/sbin/startupfiletool",
                                         @"/usr/sbin/iostat",
                                         @"/usr/sbin/mkfile",
                                         @"/usr/sbin/zic",
                                         @"/usr/sbin/vipw",
                                         @"/usr/local/lib/",
                                         @"/usr/lib/libcrypto.a",
                                         @"/usr/lib/ssl/",
                                         @"/usr/lib/pkgconfig/",
                                         @"/usr/lib/libapt-inst.2.0.dylib",
                                         @"/usr/lib/libdb_sql-6.dylib",
                                         @"/usr/lib/libdb-6.2.dylib",
                                         @"/usr/lib/libapt-inst.2.0.0.dylib",
                                         @"/usr/lib/libdb.dylib",
                                         @"/usr/lib/libapt-inst.dylib",
                                         @"/usr/lib/libssl.dylib",
                                         @"/usr/lib/libdb-6.dylib",
                                         @"/usr/lib/libapt-pkg.5.0.dylib",
                                         @"/usr/lib/libdb_sql-6.2.dylib",
                                         @"/usr/lib/libapt-pkg.dylib",
                                         @"/usr/lib/libdpkg.a",
                                         @"/usr/lib/liblzma.a",
                                         @"/usr/lib/libcrypto.1.0.0.dylib",
                                         @"/usr/lib/bash/",
                                         @"/usr/lib/terminfo",
                                         @"/usr/lib/libapt-private.0.0.0.dylib",
                                         @"/usr/lib/libcrypto.dylib",
                                         @"/usr/lib/liblzma.la",
                                         @"/usr/lib/engines/",
                                         @"/usr/lib/libssl.1.0.0.dylib",
                                         @"/usr/lib/apt",
                                         @"/usr/lib/libssl.a",
                                         @"/usr/lib/libapt-private.0.0.dylib",
                                         @"/usr/lib/libdb_sql.dylib",
                                         @"/usr/lib/libapt-pkg.5.0.1.dylib",
                                         @"/usr/lib/libdpkg.la",
                                         @"/usr/games/",
                                         @"/usr/share/bigboss/",
                                         @"/usr/share/tabset/",
                                         @"/usr/share/terminfo/",
                                         @"/usr/share/dict/",
                                         @"/usr/share/gnupg/",
                                         @"/usr/share/dpkg/",
                                         @"/boot/",
                                         @"/bin/bzip2recover",
                                         @"/bin/cat",
                                         @"/bin/gtar",
                                         @"/bin/zgrep",
                                         @"/bin/zmore",
                                         @"/bin/run-parts",
                                         @"/bin/zdiff",
                                         @"/bin/echo",
                                         @"/bin/pwd",
                                         @"/bin/bunzip2",
                                         @"/bin/touch",
                                         @"/bin/sed",
                                         @"/bin/sleep",
                                         @"/bin/zless",
                                         @"/bin/stty",
                                         @"/bin/chgrp",
                                         @"/bin/uname",
                                         @"/bin/bzcat",
                                         @"/bin/date",
                                         @"/bin/readlink",
                                         @"/bin/znew",
                                         @"/bin/gzip",
                                         @"/bin/grep",
                                         @"/bin/bash",
                                         @"/bin/kill",
                                         @"/bin/sh",
                                         @"/bin/su",
                                         @"/bin/mknod",
                                         @"/bin/dd",
                                         @"/bin/mktemp",
                                         @"/bin/dir",
                                         @"/bin/mkdir",
                                         @"/bin/gzexe",
                                         @"/bin/rmdir",
                                         @"/bin/mv",
                                         @"/bin/egrep",
                                         @"/bin/zcat",
                                         @"/bin/ln",
                                         @"/bin/ls",
                                         @"/bin/true",
                                         @"/bin/cp",
                                         @"/bin/sync",
                                         @"/bin/chown",
                                         @"/bin/fgrep",
                                         @"/bin/zcmp",
                                         @"/bin/chmod",
                                         @"/bin/tar",
                                         @"/bin/rm",
                                         @"/bin/vdir",
                                         @"/bin/false",
                                         @"/bin/zegrep",
                                         @"/bin/uncompress",
                                         @"/bin/bzip2",
                                         @"/bin/zfgrep",
                                         @"/bin/zforce",
                                         @"/bin/gunzip",
                                         @"/sbin/update_dyld_shared_cache",
                                         @"/sbin/reboot",
                                         @"/sbin/halt",
                                         @"/sbin/dmesg",
                                         @"/sbin/dynamic_pager",
                                         @"/sbin/nologin",
                                         @"/Library/LaunchDaemons/com.openssh.sshd.plist",
                                         @"/Library/LaunchDaemons/com.saurik.Cydia.Startup.plist",
                                         @"/Library/dpkg/",
                                         @"/mnt/",
                                         @"/private/etc/ssl/",
                                         @"/private/etc/default/",
                                         @"/private/etc/ssh/",
                                         @"/private/etc/profile",
                                         @"/private/etc/apt/",
                                         @"/private/etc/profile.d/",
                                         @"/private/etc/alternatives/",
                                         @"/private/etc/dpkg/",
                                         @"/private/var/cache/",
                                         @"/private/var/spool/",
                                         @"/private/var/lock/",
                                         @"/private/var/local/",
                                         @"/private/var/lib/",
                                         @"/private/var/log/apt/",
                                         @"/private/var/backups/",
                                         @"/lib/",
                                         @"/Applications/Cydia.app/",
                                         nil];
    for (NSString *fileName in bootstrap_file_list) {
        if (file_exists([fileName UTF8String])) {
            return true;
        }
    }
    return false;
}
